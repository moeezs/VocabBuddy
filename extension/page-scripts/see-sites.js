(()=>{"use strict";var e;!function(e){e[e.DictsOfLang=0]="DictsOfLang",e[e.GetCurrentDictionary=1]="GetCurrentDictionary",e[e.SetCurrentDictionary=2]="SetCurrentDictionary",e[e.AddNewDictionary=3]="AddNewDictionary",e[e.GetExistingDictionary=4]="GetExistingDictionary",e[e.UpdateExistingDictionary=5]="UpdateExistingDictionary",e[e.DeleteExitingDictionary=6]="DeleteExitingDictionary",e[e.GetLanguages=7]="GetLanguages",e[e.SearchWordURL=8]="SearchWordURL",e[e.StorePageData=9]="StorePageData",e[e.DeletePageData=10]="DeletePageData",e[e.GetPageData=11]="GetPageData",e[e.GetCurrentActivation=12]="GetCurrentActivation",e[e.SetCurrentActivation=13]="SetCurrentActivation",e[e.ShowDeleteHighlightsCM=14]="ShowDeleteHighlightsCM",e[e.HideDeleteHighlightsCM=15]="HideDeleteHighlightsCM",e[e.GetAllDomains=16]="GetAllDomains",e[e.GetSeeSiteData=17]="GetSeeSiteData",e[e.GetAllExtensionData=18]="GetAllExtensionData",e[e.LoadExtensionData=19]="LoadExtensionData",e[e.GetLabelsForSite=20]="GetLabelsForSite",e[e.GetURLsForLabel=21]="GetURLsForLabel",e[e.AddLabelEntry=22]="AddLabelEntry",e[e.RemoveLabelEntry=23]="RemoveLabelEntry",e[e.GetAllLabels=24]="GetAllLabels"}(e||(e={}));const t=chrome.runtime.getURL("web_pages/popup.html"),n="quiz_counter",i="close_the_quiz",o="word_questioning",s="next";class l{constructor(){this.quizWordList=[],this.isQuizActive=!1,this.wordsEncountered=0,this.myDomParser=new DOMParser}shuffle(e){let t,n;for(let i=0;i<e.length;i++)t=Math.floor(Math.random()*e.length),n=e[i],e[i]=e[t],e[t]=n}stringToElement(e){return this.myDomParser.parseFromString(e,"text/html").body.childNodes[0]}addQuizContainer(){let e=document.createElement("div");return e.id="quiz_container_box",e.setAttribute("class","dark_screen"),document.body.appendChild(e),e}updateQuizCounter(){let e=document.getElementById(n);null!==e?e.textContent=`${this.wordsEncountered}/${this.wordsEncountered+this.quizWordList.length-1}`:console.error(`Could not find element ${n}. \n                Check that quiz div was loaded propperly and contains an element with that id`)}setUpWordsAndCounter(e){this.quizWordList=[];for(let t=0;t<e.wordEntries.length;t++){let n=e.wordEntries[t];this.quizWordList.push(n.word)}for(let t=0;t<e.missingWords.length;t++)this.quizWordList.push(e.missingWords[t]);this.shuffle(this.quizWordList),this.wordsEncountered=1,this.updateQuizCounter()}setUpQuiz(t,n){this.setUpWordsAndCounter(t);let l=document.getElementById(i);if(null===l)return void console.error(`Could not find element ${i}. \n                Check that quiz div was loaded propperly and contains an element with that id`);l.addEventListener("click",(()=>{null!==n.parentNode&&n.parentNode.removeChild(n),this.isQuizActive=!1}));let r=document.getElementById(o);if(null===r)return void console.error(`Could not find element ${o}. \n            Check that quiz div was loaded propperly and contains an element with that id`);r.textContent=this.quizWordList[this.quizWordList.length-1],r.addEventListener("click",(()=>{!function(t){if(null!==t&&""!==t){console.log(`Looking up: ${t}`);let n={messageType:e.SearchWordURL,payload:{word:t}};chrome.runtime.sendMessage(n)}}(r.textContent)}));let a=document.getElementById(s);null!==a?(a.addEventListener("click",(()=>{this.quizWordList.pop(),0===this.quizWordList.length?this.setUpWordsAndCounter(t):(this.wordsEncountered++,this.updateQuizCounter()),r.textContent=this.quizWordList[this.quizWordList.length-1]})),this.isQuizActive=!0):console.error(`Could not find element ${s}. \n                Check that quiz div was loaded propperly and contains an element with that id`)}loadQuizHTML(e){!this.isQuizActive&&e.wordEntries.length+e.wordEntries.length>0&&fetch(chrome.runtime.getURL("cross-page-assets/quiz.html")).then((e=>e.text())).then((t=>{let n=this.addQuizContainer(),i=this.stringToElement(t);n.appendChild(i),this.setUpQuiz(e,n)}))}}var r=function(e,t,n,i){return new(n||(n=Promise))((function(o,s){function l(e){try{a(i.next(e))}catch(e){s(e)}}function r(e){try{a(i.throw(e))}catch(e){s(e)}}function a(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(l,r)}a((i=i.apply(e,t||[])).next())}))};const a=document.getElementById("site-name-header"),d=document.getElementById("labels-list-section"),c=document.getElementById("missing-words"),u=document.getElementById("present-words"),m=document.getElementById("labels-section"),h=document.getElementById("missing-words-section"),y=document.getElementById("present-words-section"),p=document.getElementById("quiz-button");function g(t,n,i){m.style.display="inline-block",y.style.display="inline-block",h.style.display="inline-block",p.style.display="inline-block",function(t,n){r(this,void 0,void 0,(function*(){const i=yield n,o=(n,o)=>{const s=i[o];n.splice(o,1);const l={messageType:e.RemoveLabelEntry,payload:{url:t,label:s}};chrome.runtime.sendMessage(l)};b(i,"labels-list-section",i,o),E(i,t,o)}))}(t,i),function(e,t){r(this,void 0,void 0,(function*(){const n=yield t,i=void 0===n.title?e:n.title;a.innerHTML=`<a target="_blank" href=${e}>${i}</a>`;const o=n.missingWords;b(n.wordEntries.map((e=>e.word)),"present-words",n,((t,n)=>{t.wordEntries.splice(n,1),L(e,t)})),b(o,"missing-words",n,((t,n)=>{t.missingWords.splice(n,1),L(e,t)}));const s=new l;p.addEventListener("click",(()=>{s.loadQuizHTML(n)}))}))}(t,n)}function E(t,n,i){const o=document.createElement("div");o.setAttribute("class","word-item");const s=document.createElement("p");s.textContent="+",s.setAttribute("class","add-element-plus add-element-item"),s.addEventListener("click",(()=>{const o=document.getElementById("new-label-id").value.trim();if(0===o.length||o.length>24)return;t.push(o);const s={messageType:e.AddLabelEntry,payload:{url:n,label:o}};chrome.runtime.sendMessage(s),b(t,"labels-list-section",t,i),E(t,n,i)})),o.append(s);const l=document.createElement("input");l.setAttribute("id","new-label-id"),l.setAttribute("type","text"),l.setAttribute("name","new-label-name"),l.setAttribute("class","add-element-item"),o.append(l),d.append(o)}function L(t,n){const i={messageType:e.StorePageData,payload:{url:t,data:n}};chrome.runtime.sendMessage(i)}function b(e,t,n,i){const o=document.getElementById(t);o.innerHTML="";for(let t=0;t<e.length;t++){const s=e[t],l=document.createElement("p");l.setAttribute("class","word-item");const r=document.createElement("p");r.textContent="X",r.setAttribute("class","delete-x"),l.append(r);const a=document.createElement("p");a.textContent=s,l.append(a),o.append(l),r.addEventListener("click",(()=>{l.remove(),i(n,t)}))}}const v=document.getElementById("error-message"),f=document.getElementById("domains"),w=document.getElementById("labels"),D=document.getElementById("list-of-urls"),A=document.getElementById("search"),C=document.getElementById("delete-sites"),k=document.getElementById("domains-button"),x=document.getElementById("mod-site-data"),z=document.getElementById("domain-input"),M=document.getElementById("label-input"),B=document.getElementById("domains-div"),I=document.getElementById("labels-div");function T(e){const t=document.createElement("div");t.setAttribute("class","alt-form-element");const n=document.createElement("input");n.setAttribute("type","checkbox"),n.setAttribute("id",e.url),n.setAttribute("name",e.url),t.append(n);const i=document.createElement("a");i.setAttribute("href",e.url),i.setAttribute("target","_blank"),i.textContent=void 0===e.title?e.url:e.title,t.append(i),D.appendChild(t)}function G(e,t){const n=document.createElement("option");n.textContent=e,n.setAttribute("value",e),t.appendChild(n)}function q(e,t){const n={messageType:e,payload:null};chrome.runtime.sendMessage(n,(e=>{e.sort();for(let n=0;n<e.length;n++)G(e[n],t)}))}function S(){B.style.display="inline-block",I.style.display="inline-block",A.style.display="inline-block",v.innerHTML="",D.innerHTML="",C.style.display="none",k.style.display="none",x.style.display="none",a.innerHTML="",d.innerHTML="",u.innerHTML="",c.innerHTML="",m.style.display="none",y.style.display="none",h.style.display="none",p.style.display="none",q(e.GetAllDomains,f),q(e.GetAllLabels,w)}fetch(chrome.runtime.getURL("cross-page-assets/banner.html")).then((function(e){return n=this,i=void 0,s=function*(){const n=yield e.text();document.getElementById("banner_anchor").innerHTML+=n,window.location.href!==t&&(document.getElementById("banner_text").onclick=function(){const e=chrome.runtime.getURL("web_pages/index.html");window.location.href=e})},new((o=void 0)||(o=Promise))((function(e,t){function l(e){try{a(s.next(e))}catch(e){t(e)}}function r(e){try{a(s.throw(e))}catch(e){t(e)}}function a(t){var n;t.done?e(t.value):(n=t.value,n instanceof o?n:new o((function(e){e(n)}))).then(l,r)}a((s=s.apply(n,i||[])).next())}));var n,i,o,s})),S(),z.addEventListener("focus",(e=>{M.value=""})),M.addEventListener("focus",(e=>{z.value=""})),A.addEventListener("click",(function(){C.style.display="inline-block",k.style.display="inline-block",x.style.display="inline-block",A.style.display="none",B.style.display="none",f.innerHTML="",I.style.display="none",w.innerHTML="";const t=function(){if(z.value.length>0){const t=z.value;return{messageType:e.GetSeeSiteData,payload:{schemeAndHost:t}}}if(M.value.length>0){const t=M.value;return{messageType:e.GetURLsForLabel,payload:{label:t}}}throw"No search source is activated!"}();z.value="",M.value="",function(e){chrome.runtime.sendMessage(e,(e=>{e.sort(((e,t)=>{const n=void 0===e.title?e.url:e.title,i=void 0===t.title?t.url:t.title;return n.localeCompare(i)}));for(let t=0;t<e.length;t++)T(e[t])}))}(t)})),C.addEventListener("click",(()=>{var t;const n=document.querySelectorAll("input[type=checkbox]:checked");for(let i=0;i<n.length;i++){const o=n[i].id,s={messageType:e.DeletePageData,payload:{url:o}};chrome.runtime.sendMessage(s),null===(t=n[i].parentElement)||void 0===t||t.remove()}v.innerHTML="",0===document.querySelectorAll("input[type=checkbox]").length&&S()})),x.addEventListener("click",(()=>{const t=document.querySelectorAll("input[type=checkbox]:checked");if(1!==t.length){const e=`${t.length} sites selected, can only select 1 site to review`;return console.error(e),void(v.innerHTML=e)}v.innerHTML="";const n=t[0].id,i={messageType:e.GetPageData,payload:{url:n}},o=chrome.runtime.sendMessage(i);i.messageType=e.GetLabelsForSite;const s=chrome.runtime.sendMessage(i);C.style.display="none",k.style.display="none",x.style.display="none",document.getElementById("list-of-urls").innerHTML="",k.style.display="inline-block",g(n,o,s)})),k.addEventListener("click",S)})();